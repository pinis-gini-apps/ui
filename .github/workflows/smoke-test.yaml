  /*
    Copyright 2019 Iguazio Systems Ltd.
    
    Licensed under the Apache License, Version 2.0 (the "License") with
    an addition restriction as set forth herein. You may not use this
    file except in compliance with the License. You may obtain a copy of
    the License at http://www.apache.org/licenses/LICENSE-2.0.
    
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied. See the License for the specific language governing
    permissions and limitations under the License.
    
    In addition, you may not use the software for any purposes that are
    illegal under applicable law, and the grant of the foregoing license
    under the Apache 2.0 license is conditioned upon your compliance with
    such restriction.
    */

name: smoke-test

on:
  push:
    branches:
      - github-action-regression-test

jobs:
  smoke-test:
    name: smoke-test
    runs-on: ubuntu-latest
    env:
      REACT_APP_FUNCTION_CATALOG_URL: ${{ secrets.REACT_APP_FUNCTION_CATALOG_URL }}
      REACT_APP_MLRUN_API_URL: ${{ secrets.REACT_APP_MLRUN_API_URL }}
      REACT_APP_NUCLIO_API_URL: ${{ secrets.REACT_APP_NUCLIO_API_URL }}
      REACT_APP_IGUAZIO_API_URL: ${{ secrets.REACT_APP_IGUAZIO_API_URL }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install dependencies
        run: npm install

      - name: Add comment to HTTP client
        run: npm run add-comment-to-http-client

      - name: Run mock server
        run: npm run mock-server

      - name: Start application
        run: npm start

      - name: Run smoke test
        run: npm run test:ci-cd-smoke-1

